{% extends 'base.html' %}

{% block content %}
<section class="dashboard">
  <h2>Welcome to TrailLend</h2>
  <p>
    This is your dashboard.  
    Use the sidebar menu to navigate through different sections like Inventory, Reports, Users, and more.
  </p>

  <!-- Summary Cards -->
  <div class="cards">
    <div class="card">
      <h3>Total Users</h3>
      <p>{{ total_users }}</p>
    </div>
    <div class="card">
      <h3>Total Items</h3>
      <p>{{ total_items }}</p>
    </div>
    <div class="card">
      <h3>Total Transactions</h3>
      <p>{{ total_transactions }}</p>
    </div>
    <div class="card">
      <h3>Total Borrowed</h3>
      <p>{{ total_borrowed }}</p>
    </div>
  </div>

  <!-- Charts Grid -->
  <div class="charts">
    <div id="pieChart"></div>
    <div id="barChart"></div>
    <div id="donutChart"></div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

{{ pie_labels|json_script:"pie-labels" }}
{{ pie_values|json_script:"pie-values" }}
{{ bar_labels|json_script:"bar-labels" }}
{{ bar_values|json_script:"bar-values" }}
{{ borrowed_vs_returned|json_script:"borrowed-vs-returned" }}

<script>
document.addEventListener("DOMContentLoaded", () => {
  const pieLabels = JSON.parse(document.getElementById("pie-labels").textContent);
  const pieValues = JSON.parse(document.getElementById("pie-values").textContent);
  const barLabels = JSON.parse(document.getElementById("bar-labels").textContent);
  const barValues = JSON.parse(document.getElementById("bar-values").textContent);
  const borrowedVsReturned = JSON.parse(document.getElementById("borrowed-vs-returned").textContent);

  // ðŸŸ¢ Pie Chart - same size as donut
  const pieOptions = {
    chart: { type: "pie", height: 320 },
    series: pieValues,
    labels: pieLabels,
    colors: ["#2b7cff", "#28a745", "#f4b400", "#dc3545"],
    title: { text: "Item Category Distribution", align: "left" },
    legend: { position: "right" },
    dataLabels: { formatter: (val) => val.toFixed(1) + "%" }
  };
  new ApexCharts(document.querySelector("#pieChart"), pieOptions).render();

  // ðŸŸ  Bar Chart - Monthly Transactions
  const barOptions = {
    chart: { type: "bar", height: 320 },
    series: [{ name: "Transactions", data: barValues }],
    xaxis: { categories: barLabels },
    colors: ["#f4b400"],
    title: { text: "Monthly Transactions", align: "left" },
    plotOptions: { bar: { borderRadius: 4, columnWidth: "55%" } },
    dataLabels: { enabled: false },
  };
  new ApexCharts(document.querySelector("#barChart"), barOptions).render();

  // ðŸŸ£ Donut Chart - Borrowed vs Returned
  const donutOptions = {
    chart: { type: "donut", height: 320 },
    series: [borrowedVsReturned.returned, borrowedVsReturned.borrowed],
    labels: ["Returned", "Borrowed"],
    colors: ["#8b5cf6", "#e0e7ff"],
    title: { text: "Borrowed vs Returned", align: "left" },
    legend: { position: "right" },
    dataLabels: {
      enabled: true,
      formatter: (val) => val.toFixed(0) + "%"
    }
  };
  new ApexCharts(document.querySelector("#donutChart"), donutOptions).render();
});
</script>

<style>
.dashboard {
  padding: 20px;
  height: 100%;
  overflow: auto;
}

.cards {
  display: flex;
  gap: 20px;
  margin-top: 20px;
}

.card {
  flex: 1;
  background: #f8f9fb;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.card h3 {
  margin-bottom: 10px;
  font-size: 1.1rem;
  color: #444;
}

.card p {
  font-size: 1.5rem;
  font-weight: bold;
  color: #E5A000;
}

.charts {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 20px;
  margin-top: 30px;
}

.charts > div {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  min-height: 340px; /* ensures equal chart height */
}
</style>
{% endblock %}
