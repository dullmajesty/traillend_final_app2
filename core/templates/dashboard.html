{% extends 'base.html' %}

{% block content %}
<section class="dashboard">
  <div class="dashboard-header">
    <h2>Welcome to <span>TrailLend</span></h2>
    <p>Track key lending metrics and insights at a glance.</p>
  </div>

  <!-- Summary Cards -->
  <div class="cards">
    <div class="card gradient-blue">
      <div class="card-info">
        <h3>Total Users</h3>
        <p>{{ total_users }}</p>
      </div>
      <i class="fas fa-users"></i>
    </div>
    <div class="card gradient-green">
      <div class="card-info">
        <h3>Total Items</h3>
        <p>{{ total_items }}</p>
      </div>
      <i class="fas fa-boxes"></i>
    </div>
    <div class="card gradient-orange">
      <div class="card-info">
        <h3>Total Transactions</h3>
        <p>{{ total_transactions }}</p>
      </div>
      <i class="fas fa-exchange-alt"></i>
    </div>
    <div class="card gradient-purple">
      <div class="card-info">
        <h3>Total Borrowed</h3>
        <p>{{ total_borrowed }}</p>
      </div>
      <i class="fas fa-handshake"></i>
    </div>
  </div>

  <!-- Charts Grid -->
  <div class="charts">
    <div id="pieChart"></div>
    <div id="barChart"></div>
    <div id="donutChart"></div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://kit.fontawesome.com/a2b1f4f6e6.js" crossorigin="anonymous"></script>

{{ pie_labels|json_script:"pie-labels" }}
{{ pie_values|json_script:"pie-values" }}
{{ bar_labels|json_script:"bar-labels" }}
{{ bar_values|json_script:"bar-values" }}
{{ borrowed_vs_returned|json_script:"borrowed-vs-returned" }}

<script>
document.addEventListener("DOMContentLoaded", () => {
  const pieLabels = JSON.parse(document.getElementById("pie-labels").textContent);
  const pieValues = JSON.parse(document.getElementById("pie-values").textContent);
  const barLabels = JSON.parse(document.getElementById("bar-labels").textContent);
  const barValues = JSON.parse(document.getElementById("bar-values").textContent);
  const borrowedVsReturned = JSON.parse(document.getElementById("borrowed-vs-returned").textContent);

  const pieOptions = {
    chart: { type: "pie", height: 320 },
    series: pieValues,
    labels: pieLabels,
    colors: ["#2563eb", "#16a34a", "#f59e0b", "#dc2626"],
    title: { text: "Item Category Distribution", align: "left", style: { fontSize: "16px" } },
    legend: { position: "right" },
    dataLabels: { formatter: val => val.toFixed(1) + "%" }
  };
  new ApexCharts(document.querySelector("#pieChart"), pieOptions).render();

  const barOptions = {
    chart: { type: "bar", height: 320, toolbar: { show: false } },
    series: [{ name: "Transactions", data: barValues }],
    xaxis: { categories: barLabels },
    colors: ["#f59e0b"],
    title: { text: "Monthly Transactions", align: "left", style: { fontSize: "16px" } },
    plotOptions: { bar: { borderRadius: 6, columnWidth: "55%" } },
    dataLabels: { enabled: false },
  };
  new ApexCharts(document.querySelector("#barChart"), barOptions).render();

  const donutOptions = {
    chart: { type: "donut", height: 320 },
    series: [borrowedVsReturned.returned, borrowedVsReturned.borrowed],
    labels: ["Returned", "Borrowed"],
    colors: ["#8b5cf6", "#c7d2fe"],
    title: { text: "Borrowed vs Returned", align: "left", style: { fontSize: "16px" } },
    legend: { position: "right" },
    dataLabels: { enabled: true, formatter: val => val.toFixed(0) + "%" },
  };
  new ApexCharts(document.querySelector("#donutChart"), donutOptions).render();
});
</script>

<style>
.dashboard {
  padding: 25px;
  background: #f5f7fa;
  min-height: 100vh;
}

.dashboard-header {
  margin-bottom: 25px;
}

.dashboard-header h2 {
  font-size: 1.8rem;
  font-weight: 600;
  color: #1f2937;
}

.dashboard-header span {
  color: #2563eb;
}

.dashboard-header p {
  color: #6b7280;
  font-size: 0.95rem;
}

/* ===== Cards ===== */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-top: 25px;
}

.card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #fff;
  border-radius: 14px;
  padding: 20px 25px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.1);
}

.card-info h3 {
  font-size: 0.9rem;
  opacity: 0.9;
  margin-bottom: 5px;
  font-weight: 500;
}

.card-info p {
  font-size: 1.8rem;
  font-weight: 600;
}

.card i {
  font-size: 2.2rem;
  opacity: 0.25;
}

.gradient-blue { background: linear-gradient(135deg, #60a5fa, #2563eb); }
.gradient-green { background: linear-gradient(135deg, #4ade80, #16a34a); }
.gradient-orange { background: linear-gradient(135deg, #fbbf24, #d97706); }
.gradient-purple { background: linear-gradient(135deg, #a78bfa, #6d28d9); }

/* ===== Charts ===== */
.charts {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 25px;
  margin-top: 40px;
}

.charts > div {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  min-height: 340px;
  border-top: 4px solid #2563eb;
}
</style>
{% endblock %}
